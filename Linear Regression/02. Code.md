# Linear Regression (Code)
```r
library(ggplot2)
library(dplyr)
library(corrr)
library(recipes)
library(rsample)
library(parsnip)
library(broom)
library(yardstick)
library(tune)
```
```r
#Will be using "diamonds" dataset
dataset <- diamonds
```
**Finding correlation for non factor variables**
```r
dataset1 <- dataset %>%
    select(., where(~ !is.factor(.x))) %>%
    correlate(.) %>%
    fashion(.)
dataset1
```
![image](https://user-images.githubusercontent.com/60386381/128586743-e66496ac-c7bd-4aa9-bcd4-ea53109e6f36.png)

**Finding High Correlation Variables**
```r
high_correlation_vars <- dataset %>%
    select(., where(~ !is.factor(.x))) %>%
    correlate(.) %>%
    focus(., price) %>%
    arrange(., desc(price)) %>%
    filter(., price > .5) %>%
    pull(., term)
high_correlation_vars
```
![image](https://user-images.githubusercontent.com/60386381/128586985-60eeb16c-f7d0-43be-99e3-1d2fbf772312.png)

**Creating Quatitative Data Set**
```r
data <- dataset %>%
    select(., high_correlation_vars, price)
data
```
![image](https://user-images.githubusercontent.com/60386381/128587215-37a6bfbd-4aa8-4651-8e44-c416002cce74.png)

**Spliting the Dataset**
```r
data_split <- initial_split(data, strata = price)
data_train <- training(data_split)
data_test <- testing(data_split)
```

**Building the model**
```r
model <- lm(price ~ ., data = data_train)
summary(model)
```
![image](https://user-images.githubusercontent.com/60386381/128587451-96135568-ee71-48ab-9c5f-fea1e1fd1e89.png)
**NOTE:** Check R<sup>2</sup>(Gives high correlation) and p-value(Reject Null hypothesis)

**Summarizing the model using "broom"**
```
tidy(model)
```
![image](https://user-images.githubusercontent.com/60386381/128587637-5ec8aab1-d93f-4993-99c0-44b38979367a.png)

## For the complete dataset
**Splitting the dataset**
```r
data_split <- initial_split(dataset, strata = price)
data_train <- training(data_split)
data_test <- testing(data_split)
```

**Building the model**
```r
model <- lm(price ~ ., data = data_train)
summary(model)
```
![image](https://user-images.githubusercontent.com/60386381/128587743-30a7271e-b55b-498a-ba2f-fcc327dead0a.png)
**NOTE:** Check R<sup>2</sup>(Gives high correlation) and p-value(Reject Null hypothesis)

**Summarizing the model using "broom"**
```
tidy(model)
```
![image](https://user-images.githubusercontent.com/60386381/128587757-5aadcf59-e542-4096-8143-bb79a1b1af9d.png)

**Data Preprocessing**
```r
data_recipe <- data_train %>%
    recipe(., price ~ ., data_train) %>%
    step_dummy(., all_nominal()) %>%
    step_normalize(., all_numeric(), -all_outcomes()) %>%
    prep()
data_recipe
jucied <- juice(data_recipe)
```
![image](https://user-images.githubusercontent.com/60386381/128587894-7dfaa715-3eba-4611-8720-5ff882405d51.png)

**Specifying Model**
```r
lm_model <- linear_reg() %>%
    set_engine(., "lm") %>%
    set_mode(., "regression")
```

**Fitting the model**
```r
lm_fit <- fit(lm_model, price ~ ., juiced)
lm_fit
```
![image](https://user-images.githubusercontent.com/60386381/128588016-97200428-59c0-4f31-aad4-72e0ee1f0dc4.png)

**Analyze Model**
```r
glance(lm_fit)
```
![image](https://user-images.githubusercontent.com/60386381/128588077-c9abfc6a-5119-4aec-9c5c-ee1aab910d4c.png)

**Predict**
```r
results_train <- lm_fit %>%
    predict(., new_data = juiced) %>%
    mutate(., truth = data_train$price)
results_train
```
![image](https://user-images.githubusercontent.com/60386381/128588190-698c62ba-abef-4dc6-804c-012f1b682074.png)

```r
results_test <- lm_fit %>%
    predict(., new_data = bake(data_recipe, data_test)) %>%
    mutate(., truth = data_test$price)
results_test
```
![image](https://user-images.githubusercontent.com/60386381/128588276-c99db3d3-b090-4419-8b62-cb5b9527b2e0.png)

**Interpret**
```r
results <- results_train %>%
    mutate(., type = "train") %>%
    bind_rows(
        results_test %>%
            mutate(., type = "test")
    )
results
```
![image](https://user-images.githubusercontent.com/60386381/128588352-7bd17820-5a5c-40b0-8755-c65cceff185a.png)

```r
results %>%
    group_by(., type) %>%
    rmse(., truth, .pred)
```
![image](https://user-images.githubusercontent.com/60386381/128588429-b3ac5a57-1183-40ad-8434-f0117b270a38.png)

```r
ggplot(results, aes(truth, .pred)) + 
    geom_point() + 
    geom_abline(color = "red", size = 3) 
```
![image](https://user-images.githubusercontent.com/60386381/128588501-f4a5afba-70a8-4536-9181-90405bacbcdb.png)